name: kindn
description: create a KIND (Kubernetes in Docker) cluster
phases:
  NodeSsh:
    description: Check if VMs are SSH reachable
    node: all
    fn: vm.CheckVmSshAccess
    dependency: []

  LucAgent:
    description: Copy LUC CLI agent to all VMs
    node: all
    fn: luc.DeployLuc
    dependency:
      - NodeSsh

  OsUpgrade:
    description: Provision OS nodes with latest dnfapt packages and repositories
    node: all
    fn: dnfapt.UpgradeVmOs
    dependency:
      - LucAgent

  AppUpdate:
    description: Provision required/missing standard dnfapt packages
    node: all
    fn: dnfapt.UpdateVmOsApp
    param:
      - da.pkg.required
    dependency:
      - OsUpgrade

  GoCli:
    description: Provision Go CLI(s)
    node: all
    fn: taskgocli.InstallGoCliOnVm
    param:
      - goCli
    dependency:
      - AppUpdate

  InstallService:
    description: Provision OS service(s)
    node: all
    fn: oservice.InstallOsService
    param:
      - service
    dependency:
      - GoCli
      - EnvarSet

  UserService:
    description: Allows user services to be session-independent
    node: all
    fn: oservice.EnableLinger
    dependency:
      - GoCli

  RcFile:
    description: Create a custom RC file in user's home
    node: all
    fn: util.CreateCustomRcFile
    param:
      - customRcFileName
    dependency:
      - UserService

  EnvarPath:
    description: Configure PATH envvar into current user's custom RC file
    node: all
    fn: util.SetPath
    param:
      - binFolderPath
      - customRcFileName
    dependency:
      - RcFile

  EnvarSet:
    description: Define envvars into current user's custom RC file
    node: all
    fn: util.SetEnvar
    param:
      - customRcFileName
      - envar
    dependency:
      - EnvarPath

  ServiceStart:
    description: Start OS services needed by the app
    node: all
    fn: oservice.StartOsService
    param:
      - service
    dependency:
      - InstallService
      - EnvarSet

  Containerd:
    description: Sets up a rootless containerd env Linux session independent for the current user
    node: all
    fn: ctd.SetContainerd
    dependency:
      - ServiceStart
