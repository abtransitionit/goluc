name: kind
description: create a KIND (Kubernetes in Docker) cluster
phases:
  Ssh:
    description: Check node is SSH reachable
    node: node.bastion
    fn: CheckSshAccess
    param:
      - node.all
    dependency: []

  Agent:
    description: Copy LUC CLI
    node: node.bastion
    fn: Deploy
    dependency:
      - Ssh
    param:
      - node.all

  Os:
    description: Provision OS nodes with latest dnfapt packages and repositories
    node: node.all
    fn: UpgradeOs
    dependency:
      - Agent

  Pkg:
    description: Provision required/missing standard dnfapt packages
    node: node.all
    fn: UpdateNativePkg
    param:
      - da.pkg.required
    dependency:
      - Os

  Go:
    description: Provision Go CLI(s)
    node: node.all
    fn: InstallGoCli
    param:
      - goCli
    dependency:
      - Pkg

  InstallService:
    description: Provision OS service(s)
    node: node.all
    fn: InstallService
    param:
      - service
    dependency:
      - Go
      - Envar

  UserService:
    description: Allows user services to be session-independent
    node: node.all
    fn: EnableLinger
    dependency:
      - Go

  Rc:
    description: Create a custom RC file in user's home
    node: node.all
    fn: CreateRc
    param:
      - customRcFileName
    dependency:
      - UserService

  Path:
    description: Configure PATH envvar into current user's custom RC file
    node: node.all
    fn: SetPath
    param:
      - binFolderPath
      - customRcFileName
    dependency:
      - Rc

  Envar:
    description: Define envvars into current user's custom RC file
    node: node.all
    fn: DefineEnvar
    param:
      - customRcFileName
      - envar
    dependency:
      - Path

  ServiceStart:
    description: Start OS services needed by the app
    node: node.all
    fn: StartService
    param:
      - service
    dependency:
      - InstallService
      - Envar

  Containerd:
    description: Sets up a rootless containerd env Linux session independent for the current user
    node: node.all
    fn: SetContainerd
    dependency:
      - ServiceStart
