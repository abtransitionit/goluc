name: kind
description: create a KIND (Kubernetes in Docker) cluster
phases:
  Ssh:
    description: Check if node is SSH reachable
    node: bastion
    fn: CheckSshAccess
    param:
      - node.all
    dependency: []

  Agent:
    description: Copy LUC CLI agent to all VMs
    node: all
    fn: Deploy
    dependency:
      - Ssh

  Os:
    description: Provision OS nodes with latest dnfapt packages and repositories
    node: all
    fn: UpgradeOs
    dependency:
      - Agent

  Pkg:
    description: Provision required/missing standard dnfapt packages
    node: all
    fn: UpdateNativePkg
    param:
      - da.pkg.required
    dependency:
      - Os

  GoCli:
    description: Provision Go CLI(s)
    node: all
    fn: InstallGoCli
    param:
      - goCli
    dependency:
      - Pkg

  InstallService:
    description: Provision OS service(s)
    node: all
    fn: InstallService
    param:
      - service
    dependency:
      - GoCli
      - Envar

  UserService:
    description: Allows user services to be session-independent
    node: all
    fn: EnableLinger
    dependency:
      - GoCli

  Rc:
    description: Create a custom RC file in user's home
    node: all
    fn: CreateRc
    param:
      - customRcFileName
    dependency:
      - UserService

  Path:
    description: Configure PATH envvar into current user's custom RC file
    node: all
    fn: SetPath
    param:
      - binFolderPath
      - customRcFileName
    dependency:
      - Rc

  Envar:
    description: Define envvars into current user's custom RC file
    node: all
    fn: DefineEnvar
    param:
      - customRcFileName
      - envar
    dependency:
      - Path

  ServiceStart:
    description: Start OS services needed by the app
    node: all
    fn: StartService
    param:
      - service
    dependency:
      - InstallService
      - Envar

  Containerd:
    description: Sets up a rootless containerd env Linux session independent for the current user
    node: all
    fn: SetContainerd
    dependency:
      - ServiceStart
